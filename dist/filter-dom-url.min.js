"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _classPrivateFieldGet(a,b){var c=b.get(a);if(!c)throw new TypeError("attempted to get private field on non-instance");return c.get?c.get.call(a):c.value}function _classPrivateMethodGet(a,b,c){if(!b.has(a))throw new TypeError("attempted to get private field on non-instance");return c}var _checkAttrErrorMessage=new WeakMap,_checkDomElementAttr=new WeakSet,_parseFiltersFromUrl=new WeakSet,_updateUrl=new WeakSet,_updateFiltersDomFromUrl=new WeakSet,_updateUrlFromFiltersDom=new WeakSet,_setFiltersToUrl=new WeakSet,_resetUrl=new WeakSet,_resetDom=new WeakSet,_eventListeners=new WeakSet,Filter=function(){function a(b){_classCallCheck(this,a),_eventListeners.add(this),_resetDom.add(this),_resetUrl.add(this),_setFiltersToUrl.add(this),_updateUrlFromFiltersDom.add(this),_updateFiltersDomFromUrl.add(this),_updateUrl.add(this),_parseFiltersFromUrl.add(this),_checkDomElementAttr.add(this),_checkAttrErrorMessage.set(this,{writable:!0,value:"Filter initializing error.\n  Please enter correct attribute for DOM element"}),this.filterAttr=b.filterAttr,this.formAttr=b.formAttr,this.$form=document.querySelector("[".concat(this.formAttr,"]")),this.url=new URL(window.location.href),this.urlFilters=new URLSearchParams(decodeURIComponent(this.url.searchParams))}return _createClass(a,[{key:"init",value:function(){if(!_classPrivateMethodGet(this,_checkDomElementAttr,_checkDomElementAttr2).call(this,this.formAttr)||!_classPrivateMethodGet(this,_checkDomElementAttr,_checkDomElementAttr2).call(this,this.filterAttr))throw new Error(_classPrivateFieldGet(this,_checkAttrErrorMessage));_classPrivateMethodGet(this,_updateFiltersDomFromUrl,_updateFiltersDomFromUrl2).call(this,this.urlFilters),_classPrivateMethodGet(this,_eventListeners,_eventListeners2).call(this)}},{key:"updateDom",value:function(){_classPrivateMethodGet(this,_updateFiltersDomFromUrl,_updateFiltersDomFromUrl2).call(this,this.urlFilters)}},{key:"resetUrl",value:function(){_classPrivateMethodGet(this,_resetUrl,_resetUrl2).call(this)}},{key:"resetDom",value:function(){_classPrivateMethodGet(this,_resetDom,_resetDom2).call(this)}},{key:"setFiltersToUrl",value:function(a){_classPrivateMethodGet(this,_setFiltersToUrl,_setFiltersToUrl2).call(this,a,this.urlFilters)}},{key:"getFilters",value:function(){return _classPrivateMethodGet(this,_parseFiltersFromUrl,_parseFiltersFromUrl2).call(this,this.urlFilters)}}],[{key:"checkFilterDomType",value:function(a){var b=a.tagName.toLowerCase(),c=null;return"select"===b?c=a.multiple?"select-multiple":"select-single":"input"===b&&(c=a.type),c}}]),a}(),_checkDomElementAttr2=function(a){return"string"==typeof a&&0!==document.querySelectorAll("[".concat(a,"]")).length},_parseFiltersFromUrl2=function(a){var b=this,c=_toConsumableArray(a.entries()),d={};return 0===c.length?d:(c.forEach(function(a){var c=a[0],e=a[1],f=document.querySelector("[".concat(b.filterAttr,"=\"").concat(c,"\"]"));f&&(d[c]=e.split(" "))}),d)},_updateUrl2=function(){this.url=new URL(window.location.href),this.urlFilters=new URLSearchParams(this.url.searchParams)},_updateFiltersDomFromUrl2=function(a){var b=this,c=_classPrivateMethodGet(this,_parseFiltersFromUrl,_parseFiltersFromUrl2).call(this,a);0===Object.keys(c).length||Object.keys(c).forEach(function(a){var d=b.$form.querySelector("[".concat(b.filterAttr,"=\"").concat(a,"\"]"));if(d){var e=Filter.checkFilterDomType(d);switch(e){case"select-single":case"color":case"range":case"date":case"month":case"week":case"time":{b.$form.querySelector("[".concat(b.filterAttr,"=\"").concat(a,"\"]")).value=_toConsumableArray(c[a]);break}case"select-multiple":{var f=_toConsumableArray(b.$form.querySelector("[".concat(b.filterAttr,"=\"").concat(a,"\"]")).options);f.forEach(function(b){var d=b;0<=c[a].indexOf(d.value)&&(d.selected=!0)});break}case"radio":{b.$form.querySelector("[".concat(b.filterAttr,"=\"").concat(a,"\"][value=\"").concat(_toConsumableArray(c[a]),"\"]")).checked=!0;break}case"checkbox":{c[a].forEach(function(c){b.$form.querySelector("[".concat(b.filterAttr,"=\"").concat(a,"\"][value=\"").concat(c,"\"]")).checked=!0});break}default:{console.warn("Type '".concat(e,"' is not yet supported."));break}}}})},_updateUrlFromFiltersDom2=function(a){var b=a.target,c=b.getAttribute("".concat(this.filterAttr)),d=Filter.checkFilterDomType(b);switch(d){case"select-single":case"radio":case"color":case"range":case"date":case"month":case"week":case"time":{""===b.value?this.urlFilters["delete"](c):this.urlFilters.set(c,b.value);break}case"select-multiple":{var e=_toConsumableArray(b.options).filter(function(a){return a.selected}).map(function(a){return a.value});this.urlFilters.set(c,e.join(" "));break}case"checkbox":{var f="".concat(this.urlFilters.get(c)).split(" ");this.urlFilters.has(c)?b.checked?this.urlFilters.set(c,"".concat(this.urlFilters.get(c)," ").concat(b.value)):1<f.length?(this.urlFilters["delete"](c),f.splice(f.indexOf(b.value),1),this.urlFilters.set(c,f.join(" "))):this.urlFilters["delete"](c):this.urlFilters.append(c,b.value);break}default:{console.warn("Type '".concat(d,"' is not yet supported."));break}}},_setFiltersToUrl2=function(a,b){var c=new URL(a);c.search=b,window.history.pushState(null,null,c),_classPrivateMethodGet(this,_updateUrl,_updateUrl2).call(this)},_resetUrl2=function(){var a=this;Object.keys(_classPrivateMethodGet(this,_parseFiltersFromUrl,_parseFiltersFromUrl2).call(this,this.urlFilters)).forEach(function(b){a.urlFilters["delete"](b)}),_classPrivateMethodGet(this,_setFiltersToUrl,_setFiltersToUrl2).call(this,this.url,this.urlFilters)},_resetDom2=function(){this.$form.reset()},_eventListeners2=function(){var a=this;this.$form.querySelectorAll("[".concat(this.filterAttr,"]")).forEach(function(b){b.addEventListener("change",function(b){_classPrivateMethodGet(a,_updateUrlFromFiltersDom,_updateUrlFromFiltersDom2).call(a,b)})}),window.addEventListener("popstate",function(){_classPrivateMethodGet(a,_updateUrl,_updateUrl2).call(a),_classPrivateMethodGet(a,_resetDom,_resetDom2).call(a),_classPrivateMethodGet(a,_updateFiltersDomFromUrl,_updateFiltersDomFromUrl2).call(a,a.urlFilters)})},_default=Filter;exports["default"]=_default;