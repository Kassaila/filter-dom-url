"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}/** Class representing a Filter */var Filter=/*#__PURE__*/function(){/**
     * Create the Filter instance
     * @param {string} filterAttr - filters identification attribute
     * @param {string} formAttr - filters form identification attribute
     */function a(b){_classCallCheck(this,a),this.filterAttr=b.filterAttr,this.formAttr=b.formAttr,this.$form=document.querySelector("[".concat(this.formAttr,"]")),this.url=new URL(window.location.href),this.urlFilters=new URLSearchParams(decodeURIComponent(this.url.searchParams))}/**
   * Check filter type
   * @param {object} $filter - DOM element
   * @returns {string} - filter type
   * @example
   * Filter.__checkFilterType(document.querySelector('[data-filter="example"]'));
   */return _createClass(a,[{key:"_parseFiltersFromUrl",/**
     * Parse URLSearchParam
     * @private
     * @param {object} urlParams - URLSearchParam prototype
     * @returns {object} - {
     *  filter-type: ['filter-value'],
     * }
     */value:function(a){var b=this,c=_toConsumableArray(a.entries()),d={};return 0===c.length?d:(c.forEach(function(a){var c=a[0],e=a[1],f=document.querySelector("[".concat(b.filterAttr,"=\"").concat(c,"\"]"));f&&(d[c]=e.split(" "))}),d)}/**
     * Update url & urlFilters
     * @private
     */},{key:"_updateUrl",value:function(){this.url=new URL(window.location.href),this.urlFilters=new URLSearchParams(this.url.searchParams)}/**
     * Update DOM elements filters from url
     * @private
     * @param {object} urlParams - URLSearchParam prototype
     */},{key:"_updateFiltersFromUrl",value:function(b){var c=this,d=this._parseFiltersFromUrl(b);0===Object.keys(d).length||Object.keys(d).forEach(function(b){var e=c.$form.querySelector("[".concat(c.filterAttr,"=\"").concat(b,"\"]"));if(e){var f=a._checkFilterType(e);switch(f){case"select-single":case"color":case"range":case"date":case"month":case"week":case"time":{c.$form.querySelector("[".concat(c.filterAttr,"=\"").concat(b,"\"]")).value=_toConsumableArray(d[b]);break}case"select-multiple":{var g=_toConsumableArray(c.$form.querySelector("[".concat(c.filterAttr,"=\"").concat(b,"\"]")).options);g.forEach(function(a){var c=a;0<=d[b].indexOf(c.value)&&(c.selected=!0)});break}case"radio":{c.$form.querySelector("[".concat(c.filterAttr,"=\"").concat(b,"\"][value=\"").concat(_toConsumableArray(d[b]),"\"]")).checked=!0;break}case"checkbox":{d[b].forEach(function(a){c.$form.querySelector("[".concat(c.filterAttr,"=\"").concat(b,"\"][value=\"").concat(a,"\"]")).checked=!0});break}default:{console.warn("Type '".concat(f,"' is not yet supported."));break}}}})}/**
     * Update url from DOM elements filters
     * @private
     * @param {object} e - DOM element event
     */},{key:"_updateUrlFromFilters",value:function(b){var c=b.target,d=c.getAttribute("".concat(this.filterAttr)),e=a._checkFilterType(c);switch(e){case"select-single":case"radio":case"color":case"range":case"date":case"month":case"week":case"time":{""===c.value?this.urlFilters["delete"](d):this.urlFilters.set(d,c.value);break}case"select-multiple":{var f=_toConsumableArray(c.options).filter(function(a){return a.selected}).map(function(a){return a.value});this.urlFilters.set(d,f.join(" "));break}case"checkbox":{var g="".concat(this.urlFilters.get(d)).split(" ");this.urlFilters.has(d)?c.checked?this.urlFilters.set(d,"".concat(this.urlFilters.get(d)," ").concat(c.value)):1<g.length?(this.urlFilters["delete"](d),g.splice(g.indexOf(c.value),1),this.urlFilters.set(d,g.join(" "))):this.urlFilters["delete"](d):this.urlFilters.append(d,c.value);break}default:{console.warn("Type '".concat(e,"' is not yet supported."));break}}}/**
     * Set window location URL & update history
     * @private
     * @param {object} newUrl - URL prototype
     * @param {object} setUrlFilters - URLSearchParams prototype
     */},{key:"_setFiltersToGlobalUrl",value:function(a,b){var c=new URL(a);c.search=b,window.history.pushState(null,null,c),this._updateUrl()}/**
    * Reset url & window location URL
    * @private
    */},{key:"_resetGlobalUrl",value:function(){var a=this;Object.keys(this._parseFiltersFromUrl(this.urlFilters)).forEach(function(b){a.urlFilters["delete"](b)}),this._setFiltersToGlobalUrl(this.url,this.urlFilters)}/**
    * Reset filters DOM elements
    * @private
    */},{key:"_resetFilters",value:function(){this.$form.reset()}/**
    * Event listeners
    * @private
    */},{key:"_eventListeners",value:function(){var a=this;this.$form.querySelectorAll("[".concat(this.filterAttr,"]")).forEach(function(b){b.addEventListener("change",function(b){a._updateUrlFromFilters(b)})}),window.addEventListener("popstate",function(){a._updateUrl(),a._resetFilters(),a._updateFiltersFromUrl(a.urlFilters)})}/**
    * Instance initialization
    * @public
    */},{key:"initFilters",value:function(){this._updateFiltersFromUrl(this.urlFilters),this._eventListeners()}/**
    * Update DOM elements filters
    * @public
    */},{key:"updateFilters",value:function(){this._updateFiltersFromUrl(this.urlFilters)}/**
    * Reset url & window location URL
    * @public
    */},{key:"resetUrl",value:function(){this._resetGlobalUrl()}/**
    * Reset DOM elements filters
    * @public
    */},{key:"resetFilters",value:function(){this._resetFilters()}/**
    * Set URLSearchParams to window.location
    * @public
    * @param {object} newUrl - URL prototype
    */},{key:"setFiltersToUrl",value:function(a){this._setFiltersToGlobalUrl(a,this.urlFilters)}/**
    * Get filters types & values
    * @public
    * @returns {object} - {
    *  filter-type: ['filter-value'],
    * }
    */},{key:"getFiltersFromUrl",value:function(){return this._parseFiltersFromUrl(this.urlFilters)}}],[{key:"_checkFilterType",value:function(a){var b=a.tagName.toLowerCase(),c=null;return"select"===b?c=a.multiple?"select-multiple":"select-single":"input"===b&&(c=a.type),c}}]),a}(),_default=Filter;exports["default"]=_default;